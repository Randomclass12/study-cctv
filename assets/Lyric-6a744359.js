import{M as F}from"./Music-edd8bbeb.js";import{_ as w,r as n,h as D,s as R,P as V,i as j,q as b,B as T,o as i,c as f,b as q,F as z,k as E,j as L,x as H,t as P}from"./index-d9871d9d.js";const A={__name:"Lyric",setup(G){const v=n(null),d=n(null),o=n(0),s=n(1),p=D(()=>s.value<7?0:s.value===r.length-7?(r.length-7)*o.value:(s.value-7)*o.value),m=F(),{lyric:k,musicDuration:S,musicName:B}=R(m),r=V([]);j(()=>{h()});const u=n(!0);b(S,e=>{let l=e.toFixed(2);if(!!u.value){if(l>r.at(-1).second){s.value=r.length,g(p.value);return}for(let t=0;t<r.length;t++)if(r[t].second>=l){s.value=t,g(p.value);return}}}),b(B,e=>{m.getMusicInfo(),h(),s.value=1});const h=()=>{T(()=>{let e=k.value.split(`
`).map(l=>{if(l==="")return null;let t=l.match(/\[.*\]/)[0].length,a=l.substr(t),x=l.substr(1,8),C=M(x);return{lyric:a,duration:x,second:C}});e=e.filter(Boolean),r.length=0,r.push(...e),I()})},I=()=>{T(()=>{let{height:e}=v.value.getBoundingClientRect();o.value=parseInt(e/r.length)})},g=e=>{d.value.scrollTop=e},_=n(0),c=n(null),y=N(e=>{let l=Math.abs(e.target.scrollTop-_.value);_.value=Number(e.target.scrollTop),l>50&&(u.value=!1,c.value&&clearTimeout(c.value),c.value=setTimeout(()=>{u.value=!0},4e3))},500);function M(e){let l=e.split(":")[0],t=e.split(":")[1];return Number(l*60)+Number(t)}function N(e,l){let t=!0;return function(){t&&(setTimeout(()=>{e.apply(this,arguments),t=!0},l),t=!1)}}return(e,l)=>(i(),f("div",{class:"scrollbar-box",ref_key:"outinside",ref:d,onScroll:l[0]||(l[0]=(...t)=>L(y)&&L(y)(...t))},[q("div",{ref_key:"inside",ref:v},[(i(!0),f(z,null,E(r,(t,a)=>(i(),f("p",{class:H(["txt-p",[s.value-1===a?"color-red":""]]),key:a},P(t.lyric==""?"...":t.lyric),3))),128))],512)],544))}},O=w(A,[["__scopeId","data-v-fd8cf708"]]);export{O as default};
